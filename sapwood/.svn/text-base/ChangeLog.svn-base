2009-02-27  Sven Herzberg  <herzi@lanedo.com>

	NB#103175 - Sapwood crashes when large windows trigger BadAlloc errors

	* engine/theme-pixbuf.c (theme_pixbuf_render): enable the gdk_flush()
	call between the error traps

2009-02-27  Sven Herzberg  <herzi@lanedo.com>

	About NB#103175 - Sapwood crashes when large windows trigger BadAlloc
	errors

	Added a testcase

	* tests/Makefile.am: build and run the testcase
	* tests/large-window.c (text_view_mapped), (main),
	* tests/large-window.gtkrc: the testcase files

2009-02-27  Sven Herzberg  <herzi@lanedo.com>

	Properly execute tests against the correct modules

	* tests/Makefile.am: also use the script from the demos folder
	* tests/sapwood-wrapper: point to the correct module

2009-01-16  Sven Herzberg  <sven@imendio.com>

	Comment out my hildon-specific hack in the server wrapper file

	* tests/sapwood-wrapper: drop this

2009-01-08  Sven Herzberg  <sven@imendio.com>

	Compile against a vanilla GTK+

	* tests/double-free.c: GTK+ 2.14 doesn't allow including
	<gtk/gtktestutils.h>; Maemo-GTK doesn't include it in <gtk/gtk.h>; so
	we need this version check here

2009-01-08  Sven Herzberg  <sven@imendio.com>

	Updated to the refactored paths.

	* demos/run-demo: replaced src by engine, as this is where the engine
	is built now

2008-09-08  Sven Herzberg  <sven@imendio.com>

	Created cache_node_ref()

	* server/cache-node.c (cache_node_ref): added new function
	* server/cache-node.h: added new prototype
	* server/sapwood-server.c (process_buffer): use the cache_node_ref()
	function

2008-09-08  Sven Herzberg  <sven@imendio.com>

	Moved memory management for CacheNode into separate files; now we have
	two well-specified locations left for allocation and free of CacheNode

	* server/Makefile.am: build the new files, too
	* server/cache-node.c (cache_node_free), (cache_node_new): added new
	functions
	* server/cache-node.h: have the structure definition here; added
	declarations of the new functions
	* server/sapwood-server.c (process_buffer),
	(cleanup_pixmap_destroy): replace the code to create/free an object
	with proper function calls

2008-11-27  Sven Herzberg  <sven@imendio.com>

	Properly follow common memory management logic

	* engine/sapwood-style.c (enum_value_to_string): don't access stuff
	after freeing it; now we only leak memory (and only with debugging
	enabled), at least we don't access invalid memory anymore

2008-11-27  Sven Herzberg  <sven@imendio.com>

	Added some debug output; patch from Daniel Bormann

	* engine/sapwood-style.c (enum_value_to_string), (draw_hline),
	(draw_vline), (draw_shadow), (draw_arrow), (draw_diamond),
	(draw_string), (draw_box), (draw_flat_box), (draw_check),
	(draw_option), (draw_tab), (draw_shadow_gap), (draw_box_gap),
	(draw_expander), (draw_extension), (draw_focus), (draw_slider),
	(draw_handle), (draw_layout): added debug output

2008-11-21  Claudio Saavedra  <csaavedra@igalia.com>

	* === Release 3.1.1 ===

2008-11-07  Sven Herzberg  <sven@imendio.com>

	Fix struct field indentation

	* engine/sapwood-rc-style.h: properly align the stuff

2008-11-07  Sven Herzberg  <sven@imendio.com>

	NB#91010: shadowcolor option for labels
	Patch by Daniel Borgmann (danielb@openismus.com)

	* engine/sapwood-rc-style.c (theme_parse_shadowcolor),
	(sapwood_rc_style_parse), (sapwood_rc_style_merge):
	* engine/sapwood-rc-style.h:
	* engine/sapwood-style.c (draw_layout):
	* engine/theme-pixbuf.h:

2008-10-06  Claudio Saavedra  <csaavedra@igalia.com>

	* === Release 3.1.0 ===

2008-10-02  Daniel Borgmann  <danielb@openismus.com>

	* engine/sapwood-style.c: (draw_shadow), (draw_flat_box): Removed
	hack from draw_shadow, added focus state detection to
	draw_flat_box for entries.

2008-10-02  Daniel Borgmann  <danielb@openismus.com>

       * engine/sapwood-style.c: Hacks to enable themeing of 
       insensitive state for GtkEntry widgets.

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Renamed the function to match file and library name

	* engine/sapwood-client.c,
	* engine/sapwood-client.h: renamed the function to
	sapwood_client_get_socket()
	* engine/sapwood-pixmap.c,
	* tests/double-free.c: updated

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Moved pixbuf_proto_get_socket() into the shared library

	* engine/sapwood-client.c,
	* engine/sapwood-client.h: new location for this function
	* engine/sapwood-pixmap.c,
	* tests/double-free.c: use the shared function, not two completely
	identical but separate ones

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Renamed the enumeration value to match the file and library name

	* engine/sapwood-client.h,
	* engine/sapwood-pixmap.c,
	* tests/double-free.c: renamed the enumeration

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Moved the error enumeration into the shared header

	* engine/sapwood-client.h,
	* engine/sapwood-pixmap.h: moved the enumeration
	* tests/double-free.c: dropped the #define replacement for the
	enumeration

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Renamed the error quark to match the file and library name

	* engine/sapwood-client.c,
	* engine/sapwood-client.h,
	* engine/sapwood-pixmap.c,
	* tests/double-free.c: renamed the quark

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Moved the error quark into libsapwood-client.la

	* engine/sapwood-client.c (sapwood_pixmap_error_get_quark),
	* engine/sapwood-client.h: added the error quark
	* engine/sapwood-pixmap.c,
	* engine/sapwood-pixmap.h: delegate the error quark to the client
	library
	* tests/double-free.c: drop the error quark hack; use the quark from
	the client library

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Create libsapwood-client.la to be shared between the engine and the
	test cases

	* engine/Makefile.am: create libsapwood-client.la
	* tests/Makefile.am: link against libsapwood-client.la

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Moved the structure definition for the SapwoodPixmap into a private
	header

	* engine/Makefile.am: include the private header file
	* engine/sapwood-pixmap-priv.h: moved the structure definition to this
	file
	* engine/sapwood-pixmap.c: include the private header instead of the
	public one; dropped the structure definition
	* tests/double-free.c: include the private header file instead of
	using the copied structure definition

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Added files for reusable client code to connect to the server

	* engine/Makefile.am: added the files
	* engine/sapwood-client.c,
	* engine/sapwood-client.h: new skeletons

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Support the regular xvfb "output" of the testing framework

	* tests/double-free.c (main),
	* tests/sapwood-wrapper: drop the DISPLAY=:0.0 hacks

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Pass "make distcheck" again

	* server/Makefile.am: fixed the include path for the protocol header
	* tests/Makefile.am: fixed the reference to the wrapper script and
	distribute it with tarballs

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Fix warnings about double-assignment of EXTRA_DIST, append instead

	* demos/Makefile.am,
	* engine/Makefile.am: append to EXTRA_DIST instead of setting it

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Fix the test for the debugging flags.

	* configure.in: replace -eq (only integers) with == (strings)

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Fix "make check" finally

	* server/Makefile.am: don't perform abi checks anymore, it's only
	useful on the library

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Pass the ABI test

	* engine/sapwood-pixmap.h,
	* engine/sapwood-rc-style.h,
	* engine/sapwood-style.h: pass the ABI test by hiding internal
	functions

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Finally be able to reproduce the double free

	* tests/Makefile.am: properly set the compile flags for the testcase
	* tests/double-free.c (pixbuf_proto_get_socket),
	(pixbuf_proto_request), (sapwood_pixmap_get_for_file),
	(pixbuf_proto_unref_pixmap), (false_func), (main): implemented the
	test (with lots of copied and pasted code - needs more cleanup)
	* tests/sapwood-wrapper: added a wrapper script for the testcase
	execution

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Respect TESTS_ENVIRONMENT as "make check" usually does

	* Makefile.decl: added TESTS_ENVIRONMENT to the test invocation

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Added the first testcase

	* tests/Makefile.am,
	* tests/double-free.c: the first testcase

2008-09-29  Sven Herzberg  <sven@imendio.com>

	Added --enable-debug to define ENABLE_DEBUG properly; define
	automatically for developer builds

	* autogen.sh: pass --enable-debug to the configure script
	* configure.in: accept --enable-debug and set ENABLE_DEBUG properly

2008-09-23  Sven Herzberg  <sven@imendio.com>

	Added a folder for the tests

	* Makefile.am: include tests
	* configure.in: build tests/Makefile
	* tests/Makefile.am: skeleton

2008-09-23  Sven Herzberg  <sven@imendio.com>

	Add GTest support to the build system

	* Makefile.decl: file copied and adjusted to the project needs
	* Makefile.am,
	* demos/Makefile.am,
	* engine/Makefile.am,
	* protocol/Makefile.am,
	* server/Makefile.am: include Makefile.decl to support gtest
	everywhere

2008-09-23  Sven Herzberg  <sven@imendio.com>

	Fix a possible double-free intorduced by r15921

	* server/sapwood-server.c (process_buffer): drop the g_free() call on
	the node; the g_hash_table_remove() will care about this

2008-09-03  Sven Herzberg  <sven@imendio.com>

	added missing files

	* protocol/Makefile.am,
	* protocol/sapwood-proto.c,
	* protocol/sapwood-proto.h,
	* server/Makefile.am,
	* server/sapwood-server.c: added missing files

2008-09-03  Sven Herzberg  <sven@imendio.com>

	Split the code into server, protocol and engine parts
	based on a patch by Christian Dywan

	* engine/Makefile.am,
	* engine/abicheck.sh,
	* engine/sapwood-main.c
	* engine/sapwood-pixmap.c
	* engine/sapwood-pixmap.h,
	* engine/sapwood-proto.c,
	* engine/sapwood-proto.h,
	* engine/sapwood-rc-style.c
	* engine/sapwood-rc-style.h,
	* engine/sapwood-server.c,
	* engine/sapwood-style.c
	* engine/sapwood-style.h,
	* engine/theme-pixbuf.c
	* engine/theme-pixbuf.h,
	* src/Makefile.am,
	* src/abicheck.sh,
	* src/sapwood-main.c,
	* src/sapwood-pixmap.c,
	* src/sapwood-pixmap.h,
	* src/sapwood-proto.c,
	* src/sapwood-proto.h,
	* src/sapwood-rc-style.c,
	* src/sapwood-rc-style.h,
	* src/sapwood-server.c,
	* src/sapwood-style.c,
	* src/sapwood-style.h,
	* src/theme-pixbuf.c,
	* src/theme-pixbuf.h: split successful

2008-09-03  Sven Herzberg  <sven@imendio.com>

	Fix warnings in sapwood server
	patch from Christian Dywan

	* src/sapwood-proto.h: use a gchar[] for the filename

2008-09-03  Sven Herzberg  <sven@imendio.com>

	Use G_DEFINE_DYNAMIC_TYPE
	patch from Christian Dywan

	* src/sapwood-main.c,
	* src/sapwood-rc-style.c,
	* src/sapwood-rc-style.h,
	* src/sapwood-style.c,
	* src/sapwood-style.h: lots of cleanup here

2008-09-03  Sven Herzberg  <sven@imendio.com>

	Properly indent function signatures
	based on a patch by Christian Dywan

	* src/sapwood-pixmap.c,
	* src/sapwood-rc-style.c,
	* src/sapwood-rc-style.h,
	* src/sapwood-style.c,
	* src/theme-pixbuf.c: properly indent function signatures

2008-09-02  Sven Herzberg  <sven@imendio.com>

	Added a space before opening parenthesis
	based on a patch by Christian Dywan

	* src/sapwood-pixmap.c,
	* src/sapwood-rc-style.c,
	* src/sapwood-server.c,
	* src/sapwood-style.c,
	* src/theme-pixbuf.c: all is nice and beatiful, etc.

2008-09-02  Sven Herzberg  <sven@imendio.com>

	Drop trailing whitespaces
	based on a patch by Christian Dywan

	* src/sapwood-pixmap.c,
	* src/sapwood-rc-style.c,
	* src/sapwood-rc-style.h,
	* src/sapwood-server.c,
	* src/sapwood-style.c,
	* src/sapwood-style.h,
	* src/theme-pixbuf.c,
	* src/theme-pixbuf.h: drop trailing whitespaces

2008-09-02  Sven Herzberg  <sven@imendio.com>

	Let the filename match the name of the implemented class
	based on a patch by Christian Dywan

	* src/Makefile.am: updated file names
	* src/sapwood-render.c: removed
	* src/theme-pixbuf.c (new): moved to this name

2008-09-02  Sven Herzberg  <sven@imendio.com>

	Let the filename match the name of the implemented class
	based on a patch by Christian Dywan

	* src/Makefile.am: updated file names
	* src/sapwood-draw.c: removed
	* src/sapwood-style.c (new): moved to this name

2008-09-01  Sven Herzberg  <sven@imendio.com>

	NB#87905: Sapwood has a small memory leak
	Proposed solution by Yrjola Mika

	* src/sapwood-server.c (cleanup_pixmap_destroy): don't forget to free
	the CacheNode itself

2008-06-18  Sven Herzberg  <herzi@imendio.com>

	Debug pixmap size mismatches

	* src/sapwood-draw.c (draw_simple_image), (draw_gap_image),
	(draw_hline), (draw_vline): added a widget pointer
	* src/sapwood-main.c (theme_init): added SAPWOOD_DEBUG=scaling support
	* src/sapwood-pixmap.c (sapwood_pixmap_render_rects): debug pixmap
	scaling
	* src/sapwood-pixmap.h: added a variable to indicate whether we debug
	the sacling
	* src/sapwood-render.c (theme_pixbuf_render): added a widget pointer
	* src/theme-pixbuf.h: added a widget pointer

2007-09-25  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 3.0.0 ===

2007-09-21  Michael Natterer  <mitch@imendio.com>

	* src/sapwood-rc-style.c (sapwood_rc_style_parse): Speed up parsing a
	little by replacing g_list_append with prepend
	(sapwood_rc_style_merge): avoid a memset done by g_list_alloc() by
	using g_list_append() instead (NB#69921)

2007-09-17  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 2.91.11 ===

2007-09-17  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-render.c (theme_pixbuf_render): Ensure there's a mask
	available also when centering pixmaps with masks. Otherwise we'll
	render uninitialized data.

2007-09-14  Tommi Komulainen  <tommi.komulainen@nokia.com>

        * src/sapwood-render.c (theme_pixbuf_check_borders,
        theme_pixbuf_set_filename, theme_pixbuf_set_border): Add debugging
        helper to check image borders validity while parsing rather than
        postponing it to loading. Due to performance hit of loading every
	image one needs to build with -DENABLE_DEBUG

2007-09-11  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 2.91.10 ===

2007-09-11  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-render.c (theme_pixbuf_equal, theme_pixbuf_canonicalize):
	Move options checking to canonicalization which can be reported to the
	user more conveniently.
	* src/theme-pixbuf.h (theme_pixbuf_canonicalize): Add return value to
	indicate mismatch in options.
	* src/sapwood-rc-style.c (validate_pixbuf, CHECK_IMAGE,
	theme_parse_image): Turn the old macro to a function and add warning
	about options mismatch. 

2007-09-11  Tommi Komulainen  <tommi.komulainen@nokia.com>

	Replace GCache of pixmaps with hash of refcounted ThemePixbufs.

	Since we already have 1:1 mapping between ThemePixbuf and
	SapwoodPixmap caching the higher level object is more efficient.
	This also enables checking earlier whether two files are referenced
	with different border values (which is not supported by the server.)

	* src/theme-pixbuf.h (ThemePixbuf, theme_pixbuf_canonicalize): Updated
	bitfield and added the function.
	* src/sapwood-render.c (pixmap_cache, theme_pixbuf_copy,
	pixmap_cache_value_new): Removed
	(pixbuf_hash, theme_pixbuf_canonicalize, theme_pixbuf_ref): Added
	(theme_pixbuf_destroy, theme_pixbuf_set_filename,
	theme_pixbuf_get_pixmap): Adapted
	* src/sapwood-rc-style.c (theme_parse_image): Canonicalize

2007-09-11  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-server.c (process_buffer, cleanup_sock_removed): Add
	reference counting to pixmaps. It is already possible for one client
	to request the same pixmap multiple times, but the first release will
	invalidate all instances.

2007-09-11  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-pixmap.c (sapwood_pixmap_get_for_file)
	* src/sapwood-render.c (theme_pixbuf_set_filename): Resolve symbolic
	links before using the path as cache key. Otherwise when switching
	themes the client side can consider old and new files different and
	request new pixmap for the new theme. The symlink is resolved before
	making the request to the server, and if it resolves to the same file
	as the old one, we get a shared handle from the server. And since
	there's no server side reference counting, releasing the old pixmap
	will destroy the new one, causing BadPixmap very shortly.
	(NB#64446)

2007-09-05  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* === Release 2.91.9 ===

2007-09-05  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (draw_layout, sapwood_style_class_init): Override
	draw_layout to draw the layout without any fancy effects for
	insensitive state. (NB#66054)

2007-09-05  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* === Release 2.91.8 ===

2007-09-05  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-render.c (theme_pixbuf_render): When limiting the mask
	to (smaller) clip rectangle, *really* calculate the mask offset
	correctly. Fixes clipping in menus.

2007-09-05  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-pixmap.c (sapwood_pixmap_get_for_file): Trap and
	print X errors individually to help debugging.

2007-08-24  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (check_child_position): Initialize the position
	variable before bitwise ORing it.

2007-08-23  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-render.c (theme_pixbuf_render): When painting centered
	pixmaps don't expand but draw at most the size of the pixmap. Fixes
	uninitialized garbage appearing on screen when painting an arrow that
	is downscaled only in one direction.

2007-08-23  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-pixmap.c (sapwood_pixmap_render_rects_internal): handle
	mask == NULL without generating warnings

2007-08-23  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-render.c (theme_pixbuf_render): When limiting the mask
	to (smaller) clip rectangle, calculate the mask offset correctly.

2007-08-22  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* === Release 2.91.7 ===

2007-08-22  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (get_window_for_shape, draw_simple_image,
	draw_expander): Assume 'widget' can be NULL and don't crash. Pointed
	out by Frank Li.

2007-08-22  Lucas Rocha  <lucas.rocha@nokia.com>

	* src/sapwood-draw.c (maybe_check_submenu_state): cover menu items in
	hildon desktop custom menu widget (NB#60575)

2007-08-22  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (draw_arrow): Ignore arrows of type none. (Patch
	from Xan, added #ifdef guard) (NB#61844)
	* src/theme-pixbuf.h (ThemeMatchData): Replace GtkArrowType with
	'guint : 2' to silence compiler warnings. (GtkArrowType was extended
	with 'NONE' which doesn't make sense in rc files.)

2007-08-22  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* HACKING
	* src/sapwood-proto.h (PixbufOpenRequest)
	* src/theme-pixbuf.h (ThemePixbuf): increase the size of the border
	variables from 8 to 16 bits to allow larger borders. (NB#63819)
	NOTE: this breaks the binary protocol between client and the server

2007-08-22  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-pixmap.c (SapwoodPixmap, sapwood_pixmap_get_for_file):
	remove redundant border_left and border_top members.

2007-07-04  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* === Release 2.91.6 ===

2007-07-03  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-pixmap.c (sapwood_pixmap_render_rects): Rename to
	sapwood_pixmap_render_rects_internal.
	* src/sapwood-pixmap.h (sapwood_pixmap_render_rects): Add width and
	height parameters in order to do downscaling.
	* src/sapwood-pixmap.c (sapwood_pixmap_render_rects): When rendering
	to a target smaller than the pixmap, paint first at least as big as
	the pixmaps and scale down to target size using cairo.
	* configure.in: bump gtk+ dependency to 2.8 due to cairo

2007-07-03  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-render.c (theme_pixbuf_render): Refactor painting of
	centered pixmaps using sapwood_pixmap_render_rects()
	* src/sapwood-pixmap.h (sapwood_pixmap_render)
	* src/sapwood-pixmap.c (sapwood_pixmap_render, get_scratch_gc): Remove
	as obsolete.

2007-07-03  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-render.c (theme_pixbuf_render): When clamping the mask
	to clip mask, do not change the area to paint.

2007-06-26  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-render.c (theme_pixbuf_render): Remove unused variables.

2007-06-08  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 2.91.5 ===

2007-06-08  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (maybe_check_cursor_position): Remove special
	active focus handling, only update 'shadow' for passive focus. Improves
	handling cursor separately from selection.

	* README
	* demos/treeview.gtkrc
	* demos/images/treeview-*: Updated
	
2007-05-31  Xan Lopez  <xan.lopez@nokia.com>

	* src/sapwood-draw.c (check_child_position, check_buttonbox_child_position):
	use GTK_WIDGET_DRAWABLE instead of GTK_WIDGET_VISIBLE to check if a widget
	is currently visible in the screen.

2007-04-19  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* === Release 2.91.4 ===

2007-04-19  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-server.c (extract_pixmap_single): Revert the white
	background initialization as it adds unwanted tint to the graphics.
	Reopens MB#1216

2007-04-18  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* demos/Makefile.am
	* demos/gradient.c
	* demos/gradient.gtkrc
	* demos/images/gradient.png: Add testcase for gradient

	* src/sapwood-server.c (extract_pixmap_single): To avoid uninitialized
	pixels when loading images with alpha channel, paint the pixmap white
	first. MB#1216

2007-04-18  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* demos/Makefile.am
	* demos/images/hbbox.png: remove ugly solid black image
	* demos/images/hbbox-*.png: use proper mask for the corners
	* demos/buttonbox.gtkrc: use the all-round image as fallback

2007-04-18  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (draw_simple_image): Add missing cast for
	gtk_container_get_children

2007-04-17  Xan Lopez  <xan.lopez@nokia.com>

	* README:
	* demos/buttonbox.gtkrc:

	Update the documentation and the demo to take into account maemo-position-theming.
	
2007-04-17  Xan Lopez  <xan.lopez@nokia.com>

	* src/sapwood-draw.c (draw_simple_image): Check that the maemo-position-theming
	property exists before accessing it.

2007-04-16  Xan Lopez  <xan.lopez@nokia.com>

	* src/sapwood-draw.c (draw_simple_image): Don't take internal children
	into account for the position theming.

2007-04-13  Xan Lopez  <xan.lopez@nokia.com>

	* src/sapwood-draw.c: Add general positioning theming based on GTK+
	"maemo-position-theming" style property.

2007-04-02  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* demos/treeview.c (create_treeview): Enable rubberbanding only with
	gtk >= 2.10.0

2007-04-02  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (maybe_check_button_position): rename to
	check_child_position and generalize to handle a list of widgets.
	(check_buttonbox_child_position): new function to get the list of
	child widgets from buttonbox
	(draw_simple_image): adapt to use the new function 

2007-03-29  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 2.91.3 ===

2007-03-29  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* Makefile.am (EXTRA_DIST): Remove forgotten NEWS.pixbuf
	* src/Makefile.am (EXTRA_DIST): Remove forgotten README.pixbuf and
	README.server

2007-03-29  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (maybe_check_submenu_state, draw_box):
	Support active/passive focus on GtkMenuItems, use passive focus when
	the focus is in an item in a submenu.
	* README: add GtkMenuItem notes
	
2007-03-09  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* AUTHORS
	* NEWS.pixbuf
	* src/ChangeLog
	* src/README.pixbuf
	* src/README.server: clean up and remove obsolete documentation
	* HACKING: add documentation about the internals

2007-03-08  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* README: replace with more detailed and relevant information

2007-02-20  Xan Lopez  <xan.lopez@nokia.com>

	* sapwood-draw.c (draw_option, draw_check):
	Add special casing for GtkCheckButton and GtkRadioButton to use
	the correct graphics in the theme when the widgets have focus.

2007-02-06  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 2.91.2 ===

2007-02-06  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (draw_simple_image, get_window_for_shape): Check
	the paintable area size and apply the shape mask only when painting
	the whole window to avoid another case of infinite expose loop.

2007-01-31  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (draw_expander): Added to handle painting
	GtkExpander and treeview row expanders. Reuses arrow theming rules for
	simplicity.

2007-01-29  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* === Release 2.91.1 ===

2007-01-29  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* demos/treeview.gtkrc: Simplify treeview theming example using
	wildcards

2007-01-29  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (match_theme_image): Add simple pattern matching
	for the 'detail' to simplify treeview theming. Only leading wildcard
	is supported. In gtkrc 'detail = "*_start"' will match all details
	ending with "_start" such as "cell_even_start", "cell_odd_start",
	"cell_even_ruled_start", etc.

2007-01-29  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* demos/Makefile.am
	* demos/treeview.c
	* demos/treeview.gtkrc
	* demos/images/treeview-*.png: Example for treeview active / passive
	focus theming

2007-01-29  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (maybe_check_cursor_position)
	(draw_flat_box): When painting a treeview check if painting the cursor
	row, and adjust matching rules accordingly for active/passive focus

	Focus row background:
	  function = FLAT_BOX
	  state    = ACTIVE
	  shadow   = NONE for active, OUT for passive focus

2007-01-27  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (get_window_for_shape): Consider setting the
	window shape mask only when painting to widget->window, otherwise it
	can cause an infinite expose loop.

2007-01-25  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* === Release 2.91.0 ===

2007-01-25  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* Makefile.am (SUBDIRS)
	* configure.in (AC_OUTPUT): add demos directory

	* demos/run-demo: add wrapper script for running demos without
	installing libsapwood.so
	* demos/buttonbox.c
	* demos/buttonbox.gtkrc
	* demos/images/hbbox*.png: Example for dialog button theming

2007-01-24  Tommi Komulainen  <tommi.komulainen@nokia.com>

	Implement dialog buttons using explicit "position" keyword. The
	position is calculated only for buttons in button boxes for now.
	Specific graphics can be applied with something like:
	  position = LEFT,TOP,RIGHT,BOTTOM	(solitary)
	  position = TOP,LEFT,BOTTOM		(leftmost)
	  position = TOP,BOTTOM			(middle)
	  position = TOP,RIGHT,BOTTOM		(rightmost)

	* src/sapwood-draw.c (match_theme_image): check position flags
	(maybe_set_dialog_button_details, draw_simple_image): rename
	maybe_set_dialog_button_details to maybe_check_button_position
	(maybe_check_button_position): don't check or modify the detail,
	instead use the position match flags
	* src/sapwood-rc-style.c (theme_symbols): add "position"
	(theme_parse_position): parse "position = LEFT,RIGHT,TOP,BOTTOM"
	(theme_parse_image): parse "position"
	* src/theme-pixbuf.h: add TOKEN_POSITION and ThemePositionfFlags
	(ThemeMatchFlags): add THEME_MATCH_POSITION
	(ThemeMatchData): increase the flags size to hold
	'THEME_MATCH_POSITION' and add ThemePositionfFlags

2007-01-24  Tommi Komulainen  <tommi.komulainen@nokia.com>

	Adjust the detail for buttons in button boxes depending on the button
	position inside the button box for enhanced theming (special rounding
	for outmost button edges.) For horizontal button box we use the
	following details to work with existing themes:
	- osso_button_nesw
	- osso_button_nsw
	- osso_button_nes
	- osso_button_ns

	vertical:
	- osso_button_nesw
	- osso_button_new
	- osso_button_esw
	- osso_button_ew

	NOTE: this loses the ability to theme the 'default' response button
	differently from the others. We could use 'osso_buttondefault_nesw' or
	similar but that would then require duplicate theme declarations or
	risk really bad looking theming when the 'default' style is used
	without matching graphics. Some way to handle fallbacks
	(buttondefault-shaped - button-shaped - buttondefault - button) could
	be useful.

	* src/sapwood-draw.c (maybe_set_dialog_button_details,
	draw_simple_image): When painting GtkButtons check if it's contained
	in a button box, and if so figure out the position
	(solitary,left,right,middle - similarly for vertical) and replace the
	detail with specific ones matching the position.

2007-01-24  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-pixmap.c (sapwood_pixmap_get_pixmap): Switch x/y indices
	the right way around.

2007-01-24  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* src/sapwood-rc-style.c (theme_symbols): Remove unused tokens
	TOKEN_D_POLYGON, TOKEN_D_OVAL, TOKEN_D_STRING, TOKEN_D_CROSS,
	TOKEN_D_RAMP, TOKEN_D_ENTRY
	* src/theme-pixbuf.h: rename unused tokens to TOKEN_UNUSED_*

2007-01-24  Tommi Komulainen  <tommi.komulainen@nokia.com>

	Pass pixmaps directly instead of reverse engineering them from
	coordinates

	* src/sapwood-pixmap.h (sapwood_pixmap_get_pixmap)
	* src/sapwood-pixmap.c (get_pixmaps, sapwood_pixmap_get_pixmap):
	Export a function for getting pixmap and mask for each square
	* src/sapwood-pixmap.c (sapwood_pixmap_render_rects)
	* src/sapwood-pixmap.h (SapwoodRect)
	* src/sapwood-render.c (theme_pixbuf_render): replace source rectangle
	with pixmap and mask pointers

2007-01-24  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (draw_simple_image,draw_gap_image): remove unused
	allow_setbg parameter
	(draw_shadow,draw_arrow,draw_arrow,draw_arrow,draw_diamond,draw_box,
	draw_flat_box,draw_check,draw_option,draw_tab,draw_extension,draw_focus,
	draw_slider,draw_handle): update callers

2007-01-24  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (draw_simple_image, draw_gap_image): replace
	deprecated gdk_window_get_size() call with gdk_drawable_get_size()

2007-01-24  Tommi Komulainen  <tommi.komulainen@nokia.com>

	Export only symbols needed for the theme engine ABI

	* src/sapwood-pixmap.h
	* src/sapwood-proto.h
	* src/sapwood-rc-style.h
	* src/sapwood-style.h
	* src/theme-pixbuf.h: Tag internal functions with G_GNUC_INTERNAL to
	avoid symbol leakage.
	* src/Makefile.am: Add check target to verify the ABI.

2007-01-24  Jose Dapena Paz  <jdapena@igalia.com>

	* src/sapwood-server.c (extract_pixmap_single, main,
	get_display_depth): use system default visual depth for all pixmaps.
	This avoids crashing when running maemo desktop in a 24 bits color
	depth X server (bug #856).

2006-10-26  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 2.43 ===

2006-10-26  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-render.c (theme_pixbuf_render): Limit the mask to
	clip_rect size to avoid allocating huge pixmaps.

2006-10-26  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-render.c (theme_pixbuf_render): Trap X errors to avoid
	BadAlloc when trying to allocate *huge* bitmaps (600x33000 GtkFrame
	in a viewport) NB#35602

2006-10-26  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/Makefile.am (libsapwood_la_CFLAGS): Added to define G_LOG_DOMAIN

2006-06-13  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 2.24 ===

	* src/sapwood-server.c (pixbuf_open_response_destroy): Don't crash on
	NULL, it's a valid parameter when image loading fails.
	(process_buffer): Failure to load an image is not a client error, do
	not disconnect the client.
	N#32525

2006-05-12  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 2.19 ===

2006-05-10  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/theme-pixbuf.h (theme_pixbuf_render): Return FALSE when
	rendering fails for any reason
	* src/sapwood-draw.c (draw_simple_image): If rendering fails, do not
	apply window shape mask as it's most likely garbage
	* src/sapwood-render.c (pixmap_cache_value_new,
	theme_pixbuf_get_pixmap, theme_pixbuf_render): Do not exit, only warn
	and return error code, if pixmaps can not be loaded (someone removed
	the theme in use?)
	N#26863

2006-05-10  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 2.18 ===

2006-04-27  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-rc-style.c (theme_parse_image): Use g_new0 rather than
	g_malloc to make sure fields are initialized.
	* src/sapwood-pixmap.c (sapwood_pixmap_get_for_file): Initialize the
	buffer to silence valgrind.
	N#27967

2006-04-27  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (draw_focus): Use state parameter when matching
	images for focus to allow more flexible, state-dependent focus
	theming. N#23070

2006-04-24  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 2.17 ===
	
	* src/sapwood-pixmap.c(sapwood_pixmap_free): Do not unref NULL mask.
	N#27515

2006-04-12  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* === Release 2.14.1 ===

	* src/*.c: #include <config.h> to get configure settings correctly...
	Duh! N#26389

2006-04-03  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 2.14 ===

	* configure.in
	* NEWS: Updated

2006-04-03  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* Makefile.am (MAINTAINERCLEANFILES): Add compile and depcomp.
	* src/Makefile.am (sapwood_server_CFLAGS): Add dummy cflags to work
	with newer autotools.

2006-04-03  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-pixmap.c (sapwood_pixmap_render_rects): Use clip mask
	only if one was drawn using the tile masks from theme.
	* src/sapwood-server.c (extract_pixmap_single): Create masks only for
	pixbufs with alpha.

2006-04-03  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (draw_simple_image, get_window_for_shape): Use
	flag from gtkrc to figure out need for shape mask.
	* src/sapwood-rc-style.c (theme_symbols, theme_parse_shaped,
	theme_parse_image): Add 'shaped' (default=FALSE) token to explicitly
	enable support for shaped windows from gtkrc.
	* src/theme-pixbuf.h (ThemeImage): Trade one bit from 'refcount' to
	hold the value for TOKEN_SHAPED (replaces unused TOKEN_RECOLORABLE) in
	'background_shaped' member.

2006-04-03  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (get_window_for_shape, draw_simple_image):
	Refactor shape mask requirement logic into separate function.

2005-09-02  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 1.36 ===

	* configure.in
	* NEWS: Updated

2005-09-02  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* src/theme-pixbuf.h: restore TOKEN_RECOLORABLE for not to invalidate
	gtkrc cache files

2005-09-02  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* src/theme-pixbuf.h(struct _ThemePixbuf, struct _ThemeMatchData):
	reorder and turn various members into bitfiels and save another 12k.

2005-09-02  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* src/theme-pixbuf.h(struct _ThemePixbuf)
	* src/sapwood-render.c(theme_pixbuf_copy, theme_pixbuf_hash,
	theme_pixbuf_equal, theme_pixbuf_set_filename,
	pixmap_cache_value_new): split (absolute) filename to dirname and
	basename, keep only canonicalized copy in memory and reconstruct the
	absolute filename when needed.  Saves roughly 21k (out of 43k) memory.
	N#16158

2005-09-02  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/theme-pixbuf.h(struct _ThemeImage)
	* src/sapwood-rc-style.c(theme_symbols, theme_parse_image): remove
	unused 'recolorable' token

2005-05-27  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 1.22 ===

	* configure.in
	* NEWS: Updated

2005-05-27  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw(draw_extension): Stop expanding our designated
	drawing area, it's just wrong, wrong, wrong (#9727)

2005-05-18  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw(render_icon): Increase alpha of the background
	colored pixels used when dimming icons to avoid extreme contrast.

2005-05-13  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 1.20 ===

	* configure.in
	* NEWS: Updated

2005-05-13  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-pixmap.c(sapwood_pixmap_free): Make sure all (XChangeGC)
	operations are processed before letting the sapwood server free the
	pixmaps.  Otherwise there's a risk of getting BadPixmap errors (#11906)

2005-05-03  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 1.18.1 ===

	* configure.in
	* NEWS: Updated

2005-05-02  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c: Dim icons by drawing a simple background color
	(white) raster over the normal state icon.

	* configure.in
	* src/sapwood-server.c
	* src/Makefile.am: Remove unneeded gtk+ dependency from
	sapwood-server.

2005-04-26  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 1.18 ===

	* configure.in
	* NEWS: Updated

2005-04-26  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-pixmap.c
	* src/sapwood-server.c
	* src/sapwood-proto.h: Change ref/unref to open/close to match
	protocol semantics.

2005-04-21  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-render.c(theme_pixbuf_equal): Fix border equality
	check warnings, compare right to right, not right to bottom.

	* src/sapwood-render.c(theme_pixbuf_get_pixmap): theme_pixbuf_ref() has
	invalid semantics for GCache use (results in memory leak due to
	self-referencing.)  Introduce and use theme_pixbuf_copy() instead.
	* src/sapwood-render.c(theme_pixbuf_ref): Removed.

	* src/sapwood-pixmap.c: Generalize pixbuf_proto_get_pixmap() to
	pixbuf_proto_request() which can handle arbitrary requests and
	optional responses. 

	* src/sapwood-pixmap.c
	* src/sapwood-server.c
	* src/sapwood-proto.h: Rename PixbufRequest,PixbufResponse to
	PixbufRefRequest,PixbufRefResponse

	* src/sapwood-rc-style.c: Check all images for missing filenames
	instead of only 'background' and 'overlay' ('gap', 'gap_start',
	'gap_end' were missing.)

	* src/sapwood-pixmap.c
	* src/sapwood-server.c
	* src/sapwood-proto.h: Include request total length in the message to
	make trivial validation possible.

	* src/sapwood-pixmap.c
	* src/sapwood-server.c
	* src/sapwood-proto.h: Include opcode in the request message.

	* src/sapwood-server.c: Don't assume a read from the socket is a
	single whole request, be prepared for partial and multiple requests in
	the buffer.

	* src/sapwood-server.c
	* src/sapwood-proto.h: Assign a handle for each client requested image
	the client can use later to release the image.

	* src/sapwood-pixmap.c
	* src/sapwood-server.c
	* src/sapwood-proto.h: Add unref request to the protocol and release
	images from the client side.

2005-03-21  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/Makefile.am: Move sapwood server to $(libdir)/sapwood, this is
	not gtk-engines package anymore.

2005-03-21  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* configure.in: Check for abstract socket namespace
	* src/sapwood-pixmap.c
	* src/sapwood-server.c: Use abstract socket namespace if available to
	avoid leaving dangling sockets in the filesystem

2005-02-23  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 1.08 ===

	* configure.in
	* NEWS: Updated

2005-02-23  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* src/sapwood-server.c(client_sock_callback): Remove unused variable.

2005-02-23  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/theme-pixbuf.h
	* src/sapwood-render.c: Switch visibility of theme_pixbuf_unref()
	and theme_pixbuf_destroy()
	* src/sapwood-rc-style.c: Always unref pixbufs rather than blindly
	destroying them.  Avoids crashing on theme change (#5533)

2004-12-21  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* Creating new package by extracting (greatly modified) pixbuf engine
	from gtk-engines.

